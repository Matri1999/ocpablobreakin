<script>
    let currentIndex = 0;
    let combos = [];
    let currentName = '';
    
    function generateCombinations(name) {
        const combinations = [];
        const suffixes = ['2005', '20055', '2005-', '2005_'];
        const uppercase = name.toUpperCase();
        const lowercase = name.toLowerCase();
        const capitalize = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
        suffixes.forEach(suffix => {
            combinations.push(uppercase + suffix);
            combinations.push(lowercase + suffix);
            combinations.push(capitalize + suffix);
        });
        return [...new Set(combinations)];
    }

    function copyToClipboard(text) {
        return navigator.clipboard.writeText(text).then(() => {
            alert('Copied to clipboard: ' + text);
            return true;
        }).catch(err => {
            console.error('Copy error: ', err);
            alert('Failed to copy - try manually.');
            return false;
        });
    }

    async function checkNext() {
        if (currentIndex >= combos.length) return;
        const combo = combos[currentIndex];
        const success = await copyToClipboard(combo);
        if (success) {
            const item = document.createElement('div');
            item.className = 'combo-item';
            item.innerHTML = `<button class="copy-btn" disabled>${combo}</button>`;
            document.getElementById('checkedOutput').appendChild(item);
            
            currentIndex++;
            updateNextButton();
            
            if (currentIndex === combos.length) {
                addNameToChecked();
            }
        }
    }

    function updateNextButton() {
        const btn = document.getElementById('nextBtn');
        if (currentIndex < combos.length) {
            btn.disabled = false;
            btn.innerText = `Check next result (${currentIndex + 1}/${combos.length})`;
        } else {
            btn.disabled = true;
            btn.innerText = 'All checked';
        }
    }

    // Dodaj imię do shared listy
    function addNameToChecked() {
        fetch('checked.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: currentName })
        })
        .then(response => {
            if (!response.ok) throw new Error('Server error: ' + response.status);
            return response.json();
        })
        .then(data => {
            if (data.error) {
                alert('Error saving name: ' + data.error + '\nCheck file permissions (checked.txt should be writable)');
            } else {
                loadChecked(); // odśwież listę
                alert('Name "' + currentName + '" saved globally!');
            }
        })
        .catch(err => {
            console.error(err);
            alert('Connection error or server problem:\n' + err.message + '\nCheck if checked.php works');
        });
    }

    // Załaduj listę sprawdzonych imion
    function loadChecked() {
        fetch('checked.php')
            .then(response => {
                if (!response.ok) throw new Error('HTTP ' + response.status);
                return response.json();
            })
            .then(data => {
                const allChecked = document.getElementById('allChecked');
                allChecked.innerHTML = '';
                data.forEach(name => {
                    const item = document.createElement('div');
                    item.className = 'combo-item';
                    item.innerHTML = `<button class="copy-btn" disabled>${name}</button>`;
                    allChecked.appendChild(item);
                });
            })
            .catch(err => {
                console.error('Load error:', err);
                document.getElementById('allChecked').innerHTML = '<p style="color:red;">Error loading checked names<br>Check console (F12)</p>';
            });
    }

    function generate() {
        const name = document.getElementById('inputName').value.trim();
        if (!name) {
            alert('Enter name!');
            return;
        }
        
        document.getElementById('checkedOutput').innerHTML = '';
        
        currentName = name;
        combos = generateCombinations(name);
        const output = document.getElementById('output');
        output.innerHTML = '';
        
        combos.forEach(combo => {
            const item = document.createElement('div');
            item.className = 'combo-item';
            item.innerHTML = `<button class="copy-btn" disabled>${combo}</button>`;
            output.appendChild(item);
        });
        
        currentIndex = 0;
        updateNextButton();
        loadChecked();
    }

    // Załaduj przy starcie
    loadChecked();
</script>